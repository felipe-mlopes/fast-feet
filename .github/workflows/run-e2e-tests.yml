name: Run E2E Tests

on: [pull_request]

jobs:
  run-e2e-tests:
    name: Run E2E Tests
    runs-on: ubuntu-latest

    services:
      postgres:
        image: postgres
        ports:
          - 5432:5432
        env:
          POSTGRES_USER: postgres
          POSTGRES_PASSWORD: docker
          POSTGRES_DB: fast-feet
          PGDATA: /data/postgres

      cache:
        image: redis
        ports:
          - 6379:6379

    steps:
      - uses: actions/checkout@v3

      - uses: actions/setup-node@v3
        with:
          node-version: 18
          cache: 'npm'

      - run: npm ci

      - run: npm run test:e2e
        env:
          JWT_PRIVATE_KEY: 'LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRRHE3K2o5WFhZZ2ROM3oKdUdkVG5RcGpyR1dPU1M1aFJFREo4QjArM29QcjdzUnNQc2R6L2xBK3hUY1VHZ0JOeVpTaVRyZEFUSkdESGFkMwpXeUFHSUZxTlhZQTJ6dHZmazc0Z3Iybjg3aGRHS1cyc0pYekh5NVlmNitxQ3VhckkvN2tqeFYwNzU4aHBaRWw1CnpXeVM2bGFtRVJncUNGcGppTmZCSzBza2FxR0QyMkJOdlYvNFN3Sk1ZN01uL0hnTkxnUWJwYzRoekZyVE1tRXMKN2NTaENBTE1YYVhqSXk2cEo2b0pDZmNxYUxzUEhXK0o2TGZyQWM1cTJJQmd6YnNtQWNTWm1PcTRES0hidURCbApsQmJtb2xUbGo4S2toOUUrRDdYZ2VKbHVjZVZlZ2o4SGhWQ0h5Q296NGh2dnliazU4OElBZllwVjAxSWpCWmhkCnpreWJ0RTZOQWdNQkFBRUNnZ0VBRUFqcDFRa2crOXdlSGZsVERCRG0yYUMxbWIyQzdkNlRzWFN5K2t5RG9vRzgKWkVyd29Ba1dmd0pFM1JsZE5mSHhOQmE5U1NVd3RVczcxOWlmV2V1eFluNmtOcGx0eGxlMkhWTDduK2k4Syt5OQo4SWJxZWxSNTNabmplcUtqZG02RnUxeElIY09YR1NKZ0pYRVEzUUlqZ2RnZTF4ZVUyOEJHUVlmcjdBTmZITG1sCjNjWitPRjFkTXVzVmQwd2lEaTNJV3FJQmVHUU11WnBFRXlJaGhhZEpiMUtEZk15aE90WExRQW94bFNibVR0OTEKRjJERHZpQWR3SG5uZzdQSStTNkpqNHFSQkl6T2pWYVFnZitMV0Y1QlZvUW0xaGYrVDlva1FaQkJsME05MmdpZQpoZGs5MG5hK1Jlcmp0QU44Z1Y2WjJXSWl2ei94b0VQbmxVUTZCOEFEZlFLQmdRRDlCYzlpaFd5cUYyVUlIQklCCnViejduYXBIdWt0VzdGWnNIZWtjcEkvWlg0VUZqa0w1ZG1HK25wSkpvUU9wRlprT2FxV0pUYllTbnpMWmExUFYKZk1WdVlBVW1hMUlpY1drRGtnRUJlVkY5MjZaaVBhMDZUVmdQcUtuckNaNm1BNVpSSTdFdGwwYW1jL09jMkErbQpxdDBwQjNHRGFONjlsMlVtNWFpQk5KaklMd0tCZ1FEdHM1N0g0eTZiOURFUld5WDJyaHRUY1ZCSHRsY2RWVFFkCkNvclVFVUZ4Vk0vRUpCdHhDV1NRQm9PMzREN3RXK211dlE5aFJYUE5uamx0TFVLdndBckoxR0lkU2d4eTBOemsKRy9oc0k1RDArL25sZ3BCa3N2NjV3RWJxMjlJWXBuK2RLbWpZUkttSStpOU9HMzVLMDViWHMwZ2REV3g5THNQKwpRRDRaN1VIcUF3S0JnUUQ3TVZSMUErOGdZZjlzY0ttenl0a0NsOEZnV21QSFZQUnJlN3BkTkVhWFVFdzRlc2FrCjhORVRORXdaQ3VBZWNoRzBqVTN3SlJWWUlYS1RCUW1DamM5WHg3MzFLV0N1VHhjcGN6N0tYczMzZkNRUHJobVgKSXdnRTY3WmRYL3gvNWxuS0Rmd3RQZHpuRFlCU092STJ6YlNvc2ZvUXN3RkhDZEZqTDJiOWR1RWpBd0tCZ1FDdwpEY1dnanVkS293WmtzSG5oeHZwK1J3TUsya2FUZHpQdC9venNuUXMzZ1hXUTlKMU9qNEpvR2lzYzJYNUNGejF4CktwNWxrU2RBTjl5WXZGa1VDc3p5eDljVGtuQzk2V3h4bHpYY0FrdXU1NklqRngwVE9HL3A3RHVhWDgyd2JFRkEKaXRTMHVjWkhxZVczbUMxbUJtbEd3WWE3M2VGb3BtYUx2ZEZCS3JVVE9RS0JnRlRmRlc0R08rYVpJK20xeFFUUwpWTis2cGc1K0dYeHM2Uit5a29ZUXNPWVQxeUdDNjRyTGh1S3hZZnJ1RE5UNUhjeisrM2oxV0s3cHpFYnBlNDI0CjhmTEorMzJrY3U0T2FpNUMrbDV1enVtVmoyYVI0R1IwSk55Nm1rejhPdUdJUWdIWUpSSTRCd0Zaak1JZHcvWnYKNmxEMmRuaFdvSHVQeTZUWHNHZ2JLdVJ2Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K'
          JWT_PUBLIC_KEY: 'LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUE2dS9vL1YxMklIVGQ4N2huVTUwSwpZNnhsamtrdVlVUkF5ZkFkUHQ2RDYrN0ViRDdIYy81UVBzVTNGQm9BVGNtVW9rNjNRRXlSZ3gybmQxc2dCaUJhCmpWMkFOczdiMzVPK0lLOXAvTzRYUmlsdHJDVjh4OHVXSCt2cWdybXF5UCs1SThWZE8rZklhV1JKZWMxc2t1cFcKcGhFWUtnaGFZNGpYd1N0TEpHcWhnOXRnVGIxZitFc0NUR096Si94NERTNEVHNlhPSWN4YTB6SmhMTzNFb1FnQwp6RjJsNHlNdXFTZXFDUW4zS21pN0R4MXZpZWkzNndIT2F0aUFZTTI3SmdIRW1aanF1QXloMjdnd1paUVc1cUpVCjVZL0NwSWZSUGcrMTRIaVpibkhsWG9JL0I0VlFoOGdxTStJYjc4bTVPZlBDQUgyS1ZkTlNJd1dZWGM1TW03Uk8KalFJREFRQUIKLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tCg=='
          DATABASE_URL: 'postgresql://postgres:docker@localhost:5432/fast-feet?schema=public'
          CLOUDFLARE_ACCOUNT_ID: '73a02a25be9d38dd57837fe2b0264124'
          AWS_BUCKET_NAME: 'fast-feet-api-test'
          AWS_ACCESS_KEY_ID: '7455633cc0e0a67511e0a09fec30dab8'
          AWS_SECRET_ACCESS_KEY: 'c85d851f5259cfcc7b5d021cd8d4ee9fccad4708ae137993fdcf2214b62c4243'
          MAIL_USER: 'c6a9926bc7977e'
          MAIL_PASS: '1117668b317d50'
          MAIL_FROM: 'test@example.com'
